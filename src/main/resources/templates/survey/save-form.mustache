{{> layout/header}}
<div class="container d-flex">
    <div class="justify-content-center mx-2 pb-4 w-100">
        <div class="border border-tertiary p-5">
            <h1 class="d-inline-flex">설문지 등록하기</h1>
            <hr>
            <div class="d-flex justify-content-center">
                <button type="button" class="btn btn-outline-danger mb-3" style="width: 50%" onclick="addQuestionInput()">질문 추가하기</button>
            </div>

            <form action="/admin/surveys/save" method="post">

                <div class="px-5 mt-5"></div>

                <!-- 이 부분에 추가된 질문들이 들어갈 공간 -->
                <div class="mt-5" id="additionalQuestions"></div>


                <div class="d-flex justify-content-center mt-5">
                    <button type="submit" class="btn btn-outline-danger mb-3" style="width: 100%">등록하기</button>
                </div>
            </form>

        </div>
    </div>
</div>

<script>
    var questions = []; // 질문 배열
    var questionId = 0;
    var choiceId = 0;

    function addQuestionInput() {
        var additionalQuestionsDiv = document.getElementById("additionalQuestions");
        var questionInputDiv = document.createElement("div");
        questionInputDiv.classList.add("mt-4");

        // 각 질문을 객체로 만들어 배열에 저장
        var questionObj = {
            id: questionId,
            choices: [] // 해당 질문의 선택문항 배열
        };

        questionInputDiv.innerHTML = `
            <div class="container d-flex">
            <div class="justify-content-center mx-2 pb-4 w-100">
            <div class="border border-tertiary p-5">
            <label for="question"><b>질문</b></label>
            <button type="button" class="btn btn-outline-danger mb-1"  onclick="addChoiceInput(${questionId})">선택문항 추가하기</button>
            <input class="form-control" type="text" name="question${questionId}" required>
            <hr>
            <div id="additionalChoices${questionId}"></div>
            </div>
            </div>
            </div>
        `;

        questions.push(questionObj); // 배열에 질문 추가

        additionalQuestionsDiv.appendChild(questionInputDiv);
        questionId++; // 다음 질문 ID 증가
    }

    function addChoiceInput(questionId) {
        var additionalChoicesDiv = document.getElementById("additionalChoices" + questionId);
        var choiceInputDiv = document.createElement("div");
        choiceInputDiv.classList.add("mt-2");

        // 해당 질문의 선택문항 배열에 추가
        questions[questionId].choices.push(choiceId);

        choiceInputDiv.innerHTML = `
            <label for="choice"><b>선택문항</b></label>
            <button type="button" class="btn btn-outline-danger mb-3" onclick="removeChoiceInput(${questionId}, ${choiceId})">삭제</button>
            <input class="form-control" type="text" name="choice${choiceId}" required>

        `;

        additionalChoicesDiv.appendChild(choiceInputDiv);
        choiceId++; // 다음 선택문항 ID 증가
    }

    function removeChoiceInput(questionId, choiceId) {
        // 해당 선택문항을 선택문항 배열에서 삭제
        var index = questions[questionId].choices.indexOf(choiceId);
        if (index !== -1) {
            questions[questionId].choices.splice(index, 1);
        }

        // 해당 선택문항의 HTML 요소 제거
        var choiceInputDiv = document.getElementById("additionalChoices" + questionId);
        var choiceToRemove = document.getElementsByName(`choice${choiceId}`)[0].parentNode;
        choiceInputDiv.removeChild(choiceToRemove);
    }

</script>